<!DOCTYPE html>
<html>
  <head>
    <title>版本记录</title>
     <meta http-equiv="content-type" content="text/html; charset=UTF-8">
     <link href="popDrag.css" rel="stylesheet" type="text/css" />  
  
    <script src="../js/jquery.min.js" type="text/javascript"></script>  
    <script src="PopDrag.js" type="text/javascript"></script> 
    
		
		<script src="../bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script src="../bootstrap-table/js/bootstrap-table.js"></script>
		<script src="../bootstrap-table/js/bootstrap-table-zh-CN.js"></script>
    
    <link rel="stylesheet" href="../bootstrap/3.3.4/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../bootstrap-table/css/bootstrap-table.css" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"> 
    
    
    
    <!--css文件-->
    <style type="text/css">
    .tb1{width: 100%;height: 50%;background-color: #ff0c70;margin-top: 20px }
    .next{width: 100%;height:23px;position: fixed;bottom: 5px;left: 30%}
    #currentPage{max-width: 30px;text-align: center; }
    #skillPage{max-width: 40px;text-align: center;margin-left: 50px }
    .tb1 td{ text-align:center;}
      .panel-group{max-height:770px;overflow: auto;}
            .leftMenu{margin:10px;margin-top:5px;}
            .leftMenu .panel-heading{font-size:14px;padding-left:20px;height:36px;line-height:36px;color:white;position:relative;cursor:pointer;}/*转成手形图标*/
            .leftMenu .panel-heading span{position:absolute;right:10px;top:12px;}
            .leftMenu .menu-item-left{padding: 2px; background: transparent; border:1px solid transparent;border-radius: 6px;}
            .leftMenu .menu-item-left:hover{background:#C4E3F3;border:1px solid #1E90FF;}
    
    </style>
   
  </head>
  
  
  <body>
   <div class="row">
            <div class="col-md-2">
                <div class="panel-group table-responsive" role="tablist">
                    <div class="panel panel-primary leftMenu">
                        <!-- 利用data-target指定要折叠的分组列表 -->
                        <div class="panel-heading" id="collapseListGroupHeading1" data-toggle="collapse" data-target="#collapseListGroup1" role="tab" >
                            <h4 class="panel-title">
                                基础资料
                                <span class="glyphicon glyphicon-chevron-up right"></span>
                            </h4>
                        </div>
                        <!-- .panel-collapse和.collapse标明折叠元素 .in表示要显示出来 -->
                        <div id="collapseListGroup1" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="collapseListGroupHeading1">
                            <ul class="list-group">
                              <li class="list-group-item">
                                <!-- 利用data-target指定URL -->
                                <button class="menu-item-left" data-target="test2.html" id=tab11>
                                    <span class="glyphicon glyphicon-triangle-right"></span>人员信息
                                </button>
                              </li>
                              <li class="list-group-item">
                                <button class="menu-item-left">
                                    <span class="glyphicon glyphicon-triangle-right"></span>时间类型
                                </button>
                              </li>
                              
                            </ul>
                        </div>
                    </div><!--panel end-->
                    <div class="panel panel-primary leftMenu">
                        <div class="panel-heading" id="collapseListGroupHeading2" data-toggle="collapse" data-target="#collapseListGroup2" role="tab" >
                            <h4 class="panel-title">
                                基本功能
                                <span class="glyphicon glyphicon-chevron-down right"></span>
                            </h4>
                        </div>
                        <div id="collapseListGroup2" class="panel-collapse collapse" role="tabpanel" aria-labelledby="collapseListGroupHeading2">
                            <ul class="list-group">
                              <li class="list-group-item">
                                <button class="menu-item-left">
                                    <span class="glyphicon glyphicon-triangle-right"></span>开单
                                </button>
                              </li>
                              <li class="list-group-item">
                                <button class="menu-item-left">
                                    <span class="glyphicon glyphicon-triangle-right"></span>分组项2-2
                                </button>
                              </li>
                              <li class="list-group-item">
                                <button class="menu-item-left">
                                    <span class="glyphicon glyphicon-triangle-right"></span>分组项2-3
                                </button>
                              </li>
                              <li class="list-group-item">
                                <button class="menu-item-left">
                                    <span class="glyphicon glyphicon-triangle-right"></span>报表
                                </button>
                              </li>
                            </ul>
                        </div>
                    </div>  
   <div class="panel panel-primary leftMenu">
                        <div class="panel-heading" id="collapseListGroupHeading3" data-toggle="collapse" data-target="#collapseListGroup3" role="tab" >
                            <h4 class="panel-title">
                                设置
                                <span class="glyphicon glyphicon-chevron-down right"></span>
                            </h4>
                        </div>
                        <div id="collapseListGroup3" class="panel-collapse collapse" role="tabpanel" aria-labelledby="collapseListGroupHeading2">
                            <ul class="list-group">
                              <li class="list-group-item">
                                <button class="menu-item-left">
                                    <span class="glyphicon glyphicon-triangle-right"></span>开单
                                </button>
                              </li>
                              <li class="list-group-item">
                                <button class="menu-item-left">
                                    <span class="glyphicon glyphicon-triangle-right"></span>分组项2-2
                                </button>
                              </li>
                              <li class="list-group-item">
                                <button class="menu-item-left">
                                    <span class="glyphicon glyphicon-triangle-right"></span>分组项2-3
                                </button>
                              </li>
                              <li class="list-group-item">
                                <button class="menu-item-left">
                                    <span class="glyphicon glyphicon-triangle-right"></span>报表
                                </button>
                              </li>
                            </ul>
                        </div>
                    </div>  

                </div>
            </div>
      <div class="col-md-10" >
      
               
         
  
  
  <div>
      <input type="date" value="2015-09-24" id="startDate"/>  
      <input type="date" value="2015-09-24" id="endDate"/> 
      <input type="text"  id="gongdan"/>
      <input type="text"  id="liaohao"/>
      <button   id="btnselect">查询</button>
      
    </div>  
    
    <div id="toolbar" class="btn-group">
            <button id="btn_add" type="button" class="btn btn-default">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
            </button>
            <button id="btn_edit" type="button" class="btn btn-default">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
            </button>
            <button id="btn_delete" type="button" class="btn btn-default">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
            </button>
        </div>
  <table  id="tbevent"></table> 
  
  
  
  
  <!-- 
   <thead id="thead">
  <tr>
  <th> 全选 </th>
  <th> 用户  </th>
  <th> 类型  </th>
  <th> 描述</th>
 
  
  
  </tr>
   </thead>
  
   <tbody id="tbody">
  
  <tr >

  <td><input type="checkbox" name="xuanze" id="cb"/></td>
  
  <td id="userNo"> 11  </td>
  <td id="eventType"> 11  </td>
  <td id="eventDes"> 11</td>  
  
 
  <td>
  <button   onclick="updateInfo()">修改</button>
  <button   onclick="deleteInfo()">删除</button>   
     </td>  
  </tr>

 </tbody>
   </table> 
    -->
   
  <div id="textPopBox" class="popBox" >  
    <h3 class="popBoxHandle">版本记录添加</h3>  
     
        <table width="100%" cellspacing="5">  
           
         
           
              <tr >  
                <td width="120" align="right"><label>用户名</label></td>  
                <td align="left"> <input  type="text"  id="dia_userNo" /></td>  
            </tr>  
  </tr>  
                  <tr >  
                <td width="120" align="right"><label>事件类型</label></td>  
                <td align="left"> <input  type="text"  id="dia_eventType"  /></td>  
            </tr>  
  </tr>  
                  <tr >  
                <td width="120" align="right"><label>事件描述</label></td>  
                <td align="left"> <input  type="text" id="dia_eventDes"  /></td>  
            </tr>  
     
            <tr>  
                <td colspan="2" align="center" align="right">  
                    <br />  
                    <input id='ok' type="button" class="button green"  name="add" value="保存" />        
                    <input id='cancel' type="button" class="button blue" value="取消" />  
                </td>  
            </tr>  
        </table>  
   
</div>  
     </div>
        </div>
   <script type="text/javascript">
   var id;
   //根据窗口调整表格高度
    $(window).resize(function() {
        $("#tbevent").bootstrapTable("resetView", {
            height: tableHeight()
        })
    })
    
$(function () {
  
 //1.初始化Table
 var oTable = new TableInit();
 oTable.Init();
  
 //2.初始化Button的点击事件
 /* var oButtonInit = new ButtonInit();
 oButtonInit.Init(); */
  
 });
  var TableInit = function () {
 var oTableInit = new Object();
 //初始化Table
 oTableInit.Init = function () {
	
	
	$("#tbevent").bootstrapTable({
                 //请求方法
                method: "get",
                toolbar: "#toolbar", //工具按钮用哪个容器
                 //是否显示行间隔色
                striped: true,
                //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）     
                cache: false,    
                //是否显示分页（*）  
                pagination: true,   
                 //是否启用排序  
                sortable: false,    
                 //排序方式 
                sortOrder: "asc",    
                //初始化加载第一页，默认第一页
                //我设置了这一项，但是貌似没起作用，而且我这默认是0,- -
                pageNumber:1,   
                //每页的记录行数（*）   
                pageSize: 10,  
                //可供选择的每页的行数（*）    
                pageList: [10, 25, 50, 100],
                 showColumns: true,                  //是否显示所有的列（选择显示的列）
                showRefresh: true,                  //是否显示刷新按钮
                clickToSelect: true,                //是否启用点击选中行
                //这个接口需要处理bootstrap table传递的固定参数,并返回特定格式的json数据  
                showToggle: true,                   //是否显示详细视图和列表视图的切换按钮
                cardView: false,                    //是否显示详细视图
                detailView: false,                  //是否显示父子表
                url: "/pm/eventShow_loadEvents.action",
                //默认值为 'limit',传给服务端的参数为：(每页数量)limit, (哪一页)offset, search, sort, order Else
                //queryParamsType:'',   
                ////查询参数,每次调用是会带上这个参数，可自定义      
                
                           
                queryParams : function(params) {
                  var no = $("#gongdan").val();
                  var name = $("#liaohao").val();
                    return {
                          pageNumber: params.offset+1,
                          pageSize: params.limit,
                          //companyId:subcompany,
                          //name:name
                          userNo:no==null?"":no,
                          eventType:name=null?0:name
                        };
                },
        
                //分页方式：client客户端分页，server服务端分页（*）
                sidePagination: "server",
                //是否显示搜索
                search: true,  
                //Enable the strict search.    
                strictSearch: true,
                //Indicate which field is an identity field.
              
              columns:[{
					checkbox: true
				}, {
					field: "id",
					title: "id",
					sortable: true
				}, {
					field: "userNo",
					title: "用户名",
					sortable: true
				}, {
					field: "eventType",
					title: "类型"
				},{
					field: "eventDes",
					title: "描述"
				},
				
				{
				
                    title: '操作',
                    width: 120,
                    align: 'center',
                    valign: 'middle',
                    formatter: actionFormatter
				}],
               pagination:true,
               //双击点击，编辑界面（先获取行信息） 
              onDblClickRow: function (row) {
              p.show({
    //          x:100,  
    //          y:100  
              });
         id=row.id;
        $("#dia_userNo").attr("value",row.userNo);
        $("#dia_eventType").attr("value",row.eventType);
        $("#dia_eventDes").attr("value",row.eventDes);
        //设置这个按钮的信息 
        $("#ok").attr("value","保存");
        $("#ok").attr("name","update");
        },
           });
          };
           return oTableInit;
          };
           //操作栏的格式化
        function actionFormatter(value, row, index) {
            var id = value;
            var result = "";
            result += "<a href='javascript:;' class='btn btn-xs green' onclick=\"EditViewById('" + id + "', view='view')\" title='查看'><span class='glyphicon glyphicon-search'></span></a>";
            result += "<a href='javascript:;' class='btn btn-xs blue' onclick=\"EditViewById('" + id + "')\" title='编辑'><span class='glyphicon glyphicon-pencil'></span></a>";
            result += "<a href='javascript:;' class='btn btn-xs red' onclick=\"DeleteByIds('" + id + "')\" title='删除'><span class='glyphicon glyphicon-remove'></span></a>";

            return result;
        }	 
   
    $("#btnselect").click(function(){
   var options = $("#tbevent").bootstrapTable('refresh');
      
     
    });
      $("#tab11").click(function(){
      alert("切换");
      
     
    });
    
    $("#btn_delete").click(function(){
    //获取所选行的数组
   var selects = $("#tbevent").bootstrapTable("getSelections");
   for(var i=0;i<selects.length;i++){
   
    var str=selects[0];
   
   }
   alert(str+"");
      
     
    });
    
    
    
   var p = new PopUp({  
        //isScroll:'disabled'  
        //enableDrag:'disabled'  
        //enableShadow:'disabled'  
        //idÎªÄã×Ô¼º×Ô¶¨ÒåµÄµ¯³ö¿òdivµÄid  
        id:"textPopBox"  
    });  
  
    //Ëõ·Å´°¿ÚÊ±ÖØÐÂ¶¨Î»µ¯³ö¿ò¼°ÕÚÕÖ²ãµÄ¿í¶ÈºÍ¸ß¶È  
    EventUtil.addEvent(window,'resize', function() {  
        p.setPosition();  
        //Èç¹û¿ªÆôÕÚÕÖ²ã£¬ÕÚÕÖ²ãÔªËØ´æÔÚ£¬ÔòÖØÐÂ¶¨Î»ÕÚÕÖ²ã  
        p.enableShadow && p.enableShadow.shadow && p.enableShadow.setProperty(p.enableShadow.shadow);  
    }); 
    
    
    
    
    //点击显示 
    EventUtil.addEvent(EventUtil._$("btn_add"),'click', function() { 
     alert($("#dia_userNo").attr("value"));
        p.show({
//            x:100,  
//            y:100  
         });
     
         $("#ok").attr("value","新增");
          $("#ok").attr("name","add");
          $("#dia_userNo").attr("value","");
          $("#dia_eventType").attr("value","");
          $("#dia_eventDes").attr("value","");
          
     
          
    });  
    EventUtil.addEvent(EventUtil._$('ok'),'click', function() {
    
   
        
         //获取值
    var userNo=document.getElementById("dia_userNo").value;
    var eventType=document.getElementById("dia_eventType").value;
    var eventDes=document.getElementById("dia_eventDes").value;
   
      
    //判断是否name属性值，然后区分是添加还是修改
    if($("#ok").attr("name")=="add"){
    $.get("/pm/eventAdd_addEvent.action?userNo="+userNo+"&eventType="+eventType+"&eventDes="+eventDes,
     function(data,status){
    //alert("Data: " + data + "\nStatus: " + status);
    //解析json
    var result = $.parseJSON(data); 
    var message=result.message;
    if(message=="OK"){
     
      //刷新界面
      var options = $("#tbevent").bootstrapTable('refresh');
      
    }else{
     alert("成功与否:"+message);
    }
   
    
    
    });
     $("#dia_userNo").attr("value","");
     $("#dia_eventType").attr("value","");
     $("#dia_eventDes").attr("value","");
    p.hide();
    
    
     }  
   
    else if($("#ok").attr("name")=="update"){
     
       $.get("/pm/eventAdd_updateEvent.action?id="+id+"&userNo="+userNo+"&eventType="+eventType+"&eventDes="+eventDes,
     function(data,status){
    //alert("Data: " + data + "\nStatus: " + status);
    //解析json
    var result = $.parseJSON(data); 
     var message=result.message;
     if(message=="OK"){
    
      var options = $("#tbevent").bootstrapTable('refresh');
     //刷新界面
     }else{
     alert("修改:"+message);
     
     
     }
   
    
    
  });
    $("#dia_userNo").attr("value","");
     $("#dia_eventType").attr("value","");
     $("#dia_eventDes").attr("value","");
   p.hide();
   
      
     
    
   }  else{
   }
      //点击确定后，清空
      
       
 
      
      
      
      
      
      
      
      
      
      
      
      
      
     
       
    
        
        
         
         
        
        
         
    });  
    EventUtil.addEvent(EventUtil._$('cancel'),'click', function() {  
    
     $("#dia_userNo").attr("value","");
     $("#dia_eventType").attr("value","");
     $("#dia_eventDes").attr("value",""); 
     alert($("#dia_userNo").attr("value"));
        p.hide(); 
      
    });  
  
    //µ±°´ÏÂESC¼üÊ±¹Ø±Õµ¯³ö¿ò  
//    EventUtil.addEvent(document,'keyup',function(e) {  
//        e = e || window.event;  
//        e.keyCode == 27 && p.hide();  
//    });  
  
    EventUtil.addEvent(window,'load',function() {  
        if((isIE6 || isOpera) && p.isScroll != null && p.isScroll == 'enabled') {  
            EventUtil.addEvent(window,'scroll', function() {  
                setTimeout(function() {  
                    p.setPosition();  
                },100);  
            });  
        }  
    });  
      
   
   
 
 
    </script>
  
  
  
    
        
         
            
  </body>
</html>
